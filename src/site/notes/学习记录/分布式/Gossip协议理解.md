---
{"dg-publish":true,"permalink":"/学习记录/分布式/Gossip协议理解/"}
---

#原理 # redis

### 1. what

集群中通讯一般两种方式：

1. master-slave 模式：master 变更通知所有，master 有单点故障的，集中式发散协议
2. 还有一种就是分布式发散协议，gossip 就是的

**Gossip 协议是一种允许在分布式系统中共享状态的去【中心化】通信协议，通过这种通信协议，我们可以将信息传播给网络或集群中的所有成员。**

### 2. how

Gossip 消息传播有两种模式：

1. Anti-entropy 反熵模式

集群中的节点，每隔段时间就随机选择某个其他节点，然后通过互相交换自己的所有数据来消除两者之间的差异，实现数据的最终一致性。
交换数据：推、拉、推拉结合模式
具体实现的时候：1. 去掉随机选择 2.推的模式设计成环
![Gossip-反熵模式.png|400](/img/user/%E8%B5%84%E6%96%99%E5%BA%93/%E9%99%84%E4%BB%B6/Gossip-%E5%8F%8D%E7%86%B5%E6%A8%A1%E5%BC%8F.png)

**缺点：相互传播节点全量信息，节点较多的时候，负载大。**

2. Rumor mongering 谣言传播

谣言传播指的是分布式系统中的一个节点一旦有了新数据之后，就会变为活跃节点，活跃节点会周期性地联系其他节点向其发送新数据，直到所有的节点都存储了该新数据。
![gossip-rumor-mongering-D0IpXnM4.gif](/img/user/%E8%B5%84%E6%96%99%E5%BA%93/%E9%99%84%E4%BB%B6/gossip-rumor-mongering-D0IpXnM4.gif)

### 3. 总结

- 反熵（Anti-Entropy）会传播节点的所有数据，而谣言传播（Rumor-Mongering）只会传播节点新增的数据。
- 我们一般会给反熵设计一个闭环。
- 谣言传播（Rumor-Mongering）比较适合节点数量比较多或者节点动态变化的场景。

### 4. Gossip 的优势和劣势

**优势：**

1、相比于其他分布式协议/算法来说，Gossip 协议理解起来非常简单。**【协议简单】**

2、能够容忍网络上节点的随意地增加或者减少，宕机或者重启，因为 Gossip 协议下这些节点都是平等的，去中心化的。新增加或者重启的节点在理想情况下最终是一定会和其他节点的状态达到一致。【容错高】

3、速度相对较快。节点数量比较多的情况下，扩散速度比一个主节点向其他节点传播信息要更快（多播）。【传播速度快】

**缺陷 :**

1、消息需要通过多个传播的轮次才能传播到整个网络中，因此，必然会出现各节点状态不一致的情况。毕竟，Gossip 协议强调的是最终一致，至于达到各个节点的状态一致需要多长时间，谁也无从得知。【必然出现各状态不一致】

2、由于拜占庭将军问题，不允许存在恶意节点。[[资料库/收集箱/拜占庭将军问题 (The Byzantine Generals Problem) - 知乎\|拜占庭将军问题 (The Byzantine Generals Problem) - 知乎]] 容错性差，不能存在恶意节点】

3、可能会出现消息冗余的问题。由于消息传播的随机性，同一个节点可能会重复收到相同的消息。【消息冗余】

[[资料库/收集箱/Gossip 协议详解 _ JavaGuide\|Gossip 协议详解 _ JavaGuide]]
