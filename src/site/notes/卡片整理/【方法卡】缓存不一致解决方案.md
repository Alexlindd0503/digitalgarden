---
{"dg-publish":true,"permalink":"/卡片整理/【方法卡】缓存不一致解决方案/","tags":["方法卡"]}
---

1. DB 与 Redis 在更新数据的情况下，如果有并发更新会出现 DB 与 Redis 中数据不一致的情况。
2. 无锁的情况下，性能比较好，采用延迟双删，可以一定程度下解决不一致，但是延迟多久是个需要考虑的点，同时极端情况下还是会出现缓存不一致的。如下图：
	![资料库/附件/716e69716ec29c769605de59247ba465_MD5.png|500](/img/user/%E8%B5%84%E6%96%99%E5%BA%93/%E9%99%84%E4%BB%B6/716e69716ec29c769605de59247ba465_MD5.png)
3. 终究解决方案 ：加锁、加分布式锁，需要在两个地方加锁
	1. 查询缓存无数据，再进行加锁，查数据库，更新缓存，解锁。
	2. 再删缓存前，加锁，删缓存，更新数据库，解锁。
	3. 锁都需要设置过期时间，避免宕机造成死锁。